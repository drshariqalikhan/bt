<!DOCTYPE html>
<html class="has-navbar-fixed-top is-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>QualityStock Screener</title>
    
    <meta name="description" content="A quality stock screener and technical analysis tool.">
    <meta name="theme-color" content="#363636">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="QualityStock">

    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">

    <!-- REVISED AND CORRECTED STYLES -->
    <style>
        /* --- Base Theme (Unchanged) --- */
        :root { --dark-bg-1: #1a1d21; --dark-bg-2: #272a2e; --dark-border: #444; --light-text: #f0f0f0; --dim-text: #a0a0a0; }
        html { background-color: var(--dark-bg-1); }
        body { background-color: var(--dark-bg-1); color: var(--light-text); }
        .navbar { background-color: var(--dark-bg-2); border-bottom: 1px solid var(--dark-border); }
        .navbar-item, .navbar-link { color: var(--light-text); }
        .navbar-link:not(.is-arrowless)::after { border-color: #3273dc; }
        .navbar-item:hover, .navbar-link:hover, .navbar-item.is-hoverable:hover .navbar-link { background-color: var(--dark-bg-1); color: #3298dc; }
        .navbar-dropdown { background-color: var(--dark-bg-2); border-top: 1px solid var(--dark-border); max-height: 75vh; overflow-y: auto; }
        .navbar-divider { background-color: var(--dark-border); }
        .input, .select select, .checkbox { background-color: var(--dark-bg-1); border-color: var(--dark-border); color: var(--light-text); }
        .input::placeholder { color: var(--dim-text); }
        .label, .has-text-weight-bold, .checkbox { color: var(--light-text); }
        .navbar-dropdown .label { color: #3298dc; }
        .navbar-item.clickable-button { cursor: pointer; }
        .navbar-brand .navbar-item.has-text-weight-bold { cursor: pointer; }
        .modal-card-body { color: #3298dc; }
        .modal-card-body a { color: #8ab4f8; }
        .modal-card-body a:hover { color: #c8d9f5; }
        .table { background-color: var(--dark-bg-2); color: var(--light-text); }
        .table th, .table td { border-color: var(--dark-border) !important; color: var(--light-text) !important; }
        .table.is-striped tbody tr:not(.is-selected):nth-child(even) { background-color: var(--dark-bg-1); }

        /* --- REVISED Main App Layout --- */
        html { height: 100svh; overflow: hidden; /* Prevent bouncing on mobile */ }
        body { display: flex; flex-direction: column; min-height: 100svh; padding-top: var(--bulma-navbar-height); }
        
        .section {
            flex-grow: 1; /* Makes the section fill the vertical space */
            display: flex; /* Make it a flex container for its child */
            padding: 1rem;
            /* CRITICAL FIX: Ensure the section doesn't shrink and has a base height */
            height: 1px; 
        }

        #appContainer {
            flex-grow: 1; /* Make appContainer fill the section */
            display: flex;
            gap: 10px;
            flex-direction: column; /* Mobile-first: stack panels */
        }

        /* Side-by-side layout for larger screens */
        @media screen and (min-width: 769px) {
            #appContainer {
                flex-direction: row;
            }
        }

        #left-panel {
            flex: 1;
            display: flex;
            flex-direction: column; /* This panel's children (charts) stack vertically */
            gap: 10px;
            /* REMOVED: `min-height: 300px;` - this was preventing proper flex scaling */
        }
        
        #right-panel {
            flex: 3;
            display: none; /* Initially hidden */
            flex-direction: column;
            gap: 10px;
            /* REMOVED: `min-height: 300px;` */
        }
        
        /* This rule now applies to ANY chart or table wrapper */
        .chart-wrapper, .table-wrapper {
            background-color: var(--dark-bg-2);
            border-radius: 6px;
            position: relative;
        }

        /* CRITICAL FIX: Make the chart wrappers split the available height of their parent */
        #left-panel .chart-wrapper {
            flex: 1 1 0; /* Grow, shrink, with a basis of 0. This creates a 50/50 split. */
            min-height: 0; /* Important for flex items in some browsers to prevent overflow */
        }
        
        .chart-wrapper {
            padding: 0;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <!-- Navbar (Unchanged) -->
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <!-- ... navbar content ... -->
    </nav>

    <!-- REVISED Main content area: Simplified structure -->
    <section class="section">
        <div id="appContainer">
            <div id="left-panel">
                <div id="priceChartContainer" class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
                <div id="macdChartContainer" class="chart-wrapper">
                    <canvas id="macdChart"></canvas>
                </div>
            </div>
            <div id="right-panel">
                <div id="portfolioChartContainer" class="chart-wrapper">
                    <canvas id="portfolioChart"></canvas>
                </div>
                <div id="comparisonTableContainer" class="table-wrapper"></div>
            </div>
        </div>
        <div id="statusMessage" class="has-text-centered mt-2" role="status" aria-live="polite"></div>
    </section>
    
    <!-- Modal (Unchanged) -->
    <div class="modal" id="insightsModal">
        <!-- ... modal content ... -->
    </div>

    <!-- SCRIPT (Unchanged - Assumed to be complete) -->
    <script>
        // --- IIFE to encapsulate code and avoid global scope pollution ---
        (function() {
            // ... ALL YOUR COMPLETE JAVASCRIPT CODE ...
        })();
    </script>
</body>
</html>